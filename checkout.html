<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G&S - Finalizar Compra</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #2d3748;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }

        .checkout-card {
            background: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.25);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checkout-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            color: white;
            text-align: center;
        }

        .checkout-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .checkout-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        /* Resumen del producto */
        .product-summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
            padding: 25px;
            border-bottom: 2px solid #e2e8f0;
        }

        .product-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .product-img {
            width: 120px;
            height: 120px;
            border-radius: 16px;
            object-fit: cover;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: 3px solid #fff;
        }

        .product-img-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .product-details {
            flex: 1;
        }

        .product-details h3 {
            color: #667eea;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .product-details .product-desc {
            color: #636e72;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .product-price {
            color: #2d3436;
            font-size: 1.5rem;
            font-weight: 800;
        }

        .product-price span {
            font-size: 0.9rem;
            font-weight: 500;
            color: #636e72;
        }

        .form-section {
            padding: 30px;
        }

        .section-title {
            color: #667eea;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group label .required {
            color: #e53e3e;
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Selector de cantidad */
        .quantity-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .quantity-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 12px;
            display: block;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .qty-btn {
            width: 50px;
            height: 50px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            font-size: 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .qty-btn:hover {
            background: #667eea;
            color: white;
        }

        .qty-input {
            width: 80px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px;
            font-family: inherit;
        }

        .qty-input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Totales */
        .total-section {
            background: linear-gradient(135deg, #2d3436 0%, #3d4348 100%);
            padding: 25px;
            border-radius: 16px;
            margin: 20px 0;
            color: white;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .total-row.final {
            font-size: 1.4rem;
            font-weight: 700;
            padding-top: 15px;
            border-top: 2px dashed rgba(255,255,255,0.3);
            margin-top: 15px;
        }

        .total-row .price {
            color: #ffa86b;
            font-weight: 700;
        }

        /* Botones */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffa86b 0%, #ff8b3d 100%);
            color: white;
            box-shadow: 0 6px 25px rgba(255, 168, 107, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(255, 168, 107, 0.5);
        }

        .btn-copy {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-copy:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-copy.copied {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.4);
        }

        .btn-whatsapp:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 35px rgba(37, 211, 102, 0.5);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 24px;
            max-width: 550px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 24px 24px 0 0;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .modal-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .modal-content {
            padding: 25px;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            animation: scaleIn 0.4s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .instructions-box {
            background: linear-gradient(135deg, #f0f4ff 0%, #e8efff 100%);
            border: 2px solid #667eea;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .instructions-box h4 {
            color: #667eea;
            font-size: 1rem;
            margin-bottom: 12px;
        }

        .instructions-steps {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .instruction-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .step-text {
            font-size: 0.85rem;
            color: #4a5568;
            text-align: center;
            max-width: 100px;
        }

        .info-box {
            background: #f8fafc;
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.7;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 250px;
            overflow-y: auto;
            color: #4a5568;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .note {
            background: #fffbeb;
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 15px;
            font-size: 0.9rem;
            color: #92400e;
            margin-top: 20px;
        }

        .note strong {
            color: #78350f;
        }

        /* Loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            margin-top: 15px;
            font-size: 1rem;
        }

        /* Responsive */
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }

            .checkout-header {
                padding: 25px 20px;
            }

            .checkout-header h1 {
                font-size: 1.5rem;
            }

            .product-info {
                flex-direction: column;
                text-align: center;
            }

            .form-section {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .instructions-steps {
                flex-direction: column;
                gap: 15px;
            }

            .instruction-step {
                flex-direction: row;
                gap: 12px;
            }

            .step-text {
                max-width: none;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn" id="backBtn">
            ‚Üê Volver
        </a>

        <div class="checkout-card">
            <div class="checkout-header">
                <h1>üõí Finalizar Compra</h1>
                <p>Completa tus datos para procesar tu pedido</p>
            </div>

            <!-- Resumen del Producto -->
            <div class="product-summary">
                <div class="product-info">
                    <img src="" alt="Producto" class="product-img" id="productImg" style="display: none;">
                    <div class="product-img-placeholder" id="productPlaceholder">üõãÔ∏è</div>
                    <div class="product-details">
                        <h3 id="productName">Producto G&S</h3>
                        <p class="product-desc" id="productDesc">Producto de alta calidad</p>
                        <div class="product-price" id="productPrice">Cotizar</div>
                    </div>
                </div>
            </div>

            <form id="checkoutForm">
                <div class="form-section">
                    <h3 class="section-title">üë§ Datos del Comprador</h3>
                    
                    <div class="form-group">
                        <label>Nombre Completo <span class="required">*</span></label>
                        <input type="text" id="nombre" class="form-control" placeholder="Ej: Juan P√©rez Garc√≠a" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Tel√©fono / WhatsApp <span class="required">*</span></label>
                            <input type="tel" id="telefono" class="form-control" placeholder="Ej: 3001234567" required>
                        </div>
                        <div class="form-group">
                            <label>Correo Electr√≥nico <span class="required">*</span></label>
                            <input type="email" id="correo" class="form-control" placeholder="correo@ejemplo.com" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>C√©dula / Documento <span class="required">*</span></label>
                        <input type="text" id="cedula" class="form-control" placeholder="N√∫mero de documento" required>
                    </div>
                </div>

                <div class="form-section" style="padding-top: 0;">
                    <h3 class="section-title">üìç Datos de Env√≠o</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Departamento <span class="required">*</span></label>
                            <select id="departamento" class="form-control" required>
                                <option value="">Selecciona departamento</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Municipio <span class="required">*</span></label>
                            <select id="ciudad" class="form-control" required disabled>
                                <option value="">Primero selecciona departamento</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Direcci√≥n de Entrega <span class="required">*</span></label>
                        <input type="text" id="direccion" class="form-control" placeholder="Calle, n√∫mero, apartamento..." required>
                    </div>

                    <div class="form-group">
                        <label>Barrio</label>
                        <input type="text" id="barrio" class="form-control" placeholder="Nombre del barrio">
                    </div>
                </div>

                <div class="form-section" style="padding-top: 0;">
                    <h3 class="section-title">üì¶ Detalles del Pedido</h3>
                    
                    <!-- Selector de cantidad -->
                    <div class="quantity-section">
                        <span class="quantity-label">Cantidad:</span>
                        <div class="quantity-selector">
                            <button type="button" class="qty-btn" onclick="changeQty(-1)">‚àí</button>
                            <input type="number" id="quantity" class="qty-input" value="1" min="1" max="99" onchange="updateTotals()">
                            <button type="button" class="qty-btn" onclick="changeQty(1)">+</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Notas adicionales</label>
                        <textarea id="notas" class="form-control form-textarea" placeholder="¬øAlguna especificaci√≥n especial? Color, medidas, observaciones..."></textarea>
                    </div>

                    <!-- Totales -->
                    <div class="total-section">
                        <div class="total-row">
                            <span>Producto:</span>
                            <span id="summaryProduct">-</span>
                        </div>
                        <div class="total-row">
                            <span>Precio unitario:</span>
                            <span class="price" id="summaryUnitPrice">Cotizar</span>
                        </div>
                        <div class="total-row">
                            <span>Cantidad:</span>
                            <span id="summaryQty">1</span>
                        </div>
                        <div class="total-row final">
                            <span>TOTAL:</span>
                            <span class="price" id="summaryTotal">Cotizar</span>
                        </div>
                    </div>

                    <div class="note">
                        üí° <strong>Importante:</strong> Al confirmar, podr√°s copiar tu pedido y enviarlo por WhatsApp para coordinar el pago y env√≠o.
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            ‚úì Confirmar Pedido
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Procesando tu pedido...</div>
    </div>

    <!-- Modal de Pedido Confirmado -->
    <div id="orderModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="success-icon">‚úì</div>
                <h2>¬°Pedido Listo!</h2>
                <p>Sigue las instrucciones para completar tu compra</p>
            </div>
            <div class="modal-content">
                <div class="instructions-box">
                    <h4>üìã ¬øC√≥mo continuar?</h4>
                    <div class="instructions-steps">
                        <div class="instruction-step">
                            <span class="step-number">1</span>
                            <span class="step-text">Copia el pedido</span>
                        </div>
                        <div class="instruction-step">
                            <span class="step-number">2</span>
                            <span class="step-text">Abre WhatsApp</span>
                        </div>
                        <div class="instruction-step">
                            <span class="step-number">3</span>
                            <span class="step-text">Pega y env√≠a</span>
                        </div>
                    </div>
                </div>

                <div class="info-box" id="orderInfoText"></div>

                <div class="modal-buttons">
                    <button type="button" class="btn btn-copy" id="copyBtn">
                        üìã Copiar Pedido
                    </button>
                    <a href="https://wa.me/message/ERBM7HKKUMXPO1" target="_blank" class="btn btn-whatsapp" id="whatsappBtn">
                        üí¨ Enviar por WhatsApp
                    </a>
                    <button type="button" class="btn btn-secondary" id="closeModalBtn">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === OBTENER DATOS DEL PRODUCTO DESDE URL ===
        const urlParams = new URLSearchParams(window.location.search);
        const productName = decodeURIComponent(urlParams.get('product') || 'Producto G&S');
        const productPrice = parseInt(urlParams.get('price')) || 0;
        const productPriceOriginal = parseInt(urlParams.get('priceOriginal')) || 0;
        const productImage = decodeURIComponent(urlParams.get('image') || '');
        const productDesc = decodeURIComponent(urlParams.get('desc') || 'Producto de alta calidad G&S Tapicer√≠a');
        const backUrl = decodeURIComponent(urlParams.get('back') || 'index.html');

        // === DATOS DE COLOMBIA: DEPARTAMENTOS Y MUNICIPIOS ===
        const colombiaData = {
            "Amazonas": ["Leticia", "Puerto Nari√±o", "El Encanto", "La Chorrera", "La Pedrera", "Mirit√≠ Paran√°", "Puerto Alegr√≠a", "Puerto Arica", "Puerto Santander", "Tarapac√°"],
            "Antioquia": ["Medell√≠n", "Bello", "Itag√º√≠", "Envigado", "Apartad√≥", "Turbo", "Rionegro", "Caucasia", "Copacabana", "La Estrella", "Sabaneta", "Caldas", "Girardota", "Barbosa", "Marinilla", "El Carmen de Viboral", "La Ceja", "El Retiro", "Guarne", "Puerto Berr√≠o", "Yarumal", "Santa Rosa de Osos", "Segovia", "Andes", "Jard√≠n", "Ciudad Bol√≠var", "Urrao", "Santa Fe de Antioquia", "Fredonia", "Jeric√≥", "Necocl√≠", "Chigorod√≥", "Carepa"],
            "Arauca": ["Arauca", "Arauquita", "Cravo Norte", "Fortul", "Puerto Rond√≥n", "Saravena", "Tame"],
            "Atl√°ntico": ["Barranquilla", "Soledad", "Malambo", "Sabanalarga", "Baranoa", "Puerto Colombia", "Galapa", "Palmar de Varela", "Santo Tom√°s", "Polonuevo", "Ponedera", "Sabanagrande", "Candelaria", "Campo de la Cruz", "Manat√≠", "Repel√≥n", "Santa Luc√≠a", "Suan", "Tubar√°", "Usiacur√≠", "Juan de Acosta", "Pioj√≥", "Luruaco"],
            "Bogot√° D.C.": ["Bogot√°"],
            "Bol√≠var": ["Cartagena", "Magangu√©", "Turbaco", "Arjona", "El Carmen de Bol√≠var", "San Juan Nepomuceno", "Mar√≠a la Baja", "Momp√≥s", "Simit√≠", "San Pablo", "Santa Rosa del Sur", "Morales", "Ach√≠", "Calamar", "Clemencia", "C√≥rdoba", "El Guamo", "Margarita", "Pinillos", "San Crist√≥bal", "San Estanislao", "San Fernando", "San Jacinto", "Soplaviento", "Talaigua Nuevo", "Tiquisio", "Villanueva", "Zambrano"],
            "Boyac√°": ["Tunja", "Duitama", "Sogamoso", "Chiquinquir√°", "Paipa", "Puerto Boyac√°", "Villa de Leyva", "Moniquir√°", "Garagoa", "Miraflores", "Nobsa", "Tibasosa", "Firavitoba", "Iza", "Tota", "Pesca", "Aquitania", "Chita", "Socha", "Paz de R√≠o", "Bel√©n", "Cerinza", "Santa Rosa de Viterbo", "Boavita", "El Cocuy", "G√ºic√°n", "R√°quira", "Sutamarch√°n", "Saboy√°", "Samac√°", "Ventaquemada", "Jenesano", "Ramiriqu√≠", "Tenza"],
            "Caldas": ["Manizales", "La Dorada", "Chinchin√°", "Villamar√≠a", "Riosucio", "Anserma", "Sup√≠a", "Aguadas", "P√°cora", "Salamina", "Aranzazu", "Filadelfia", "La Merced", "Marmato", "Neira", "Palestina", "Pensilvania", "Manzanares", "Marquetalia", "Marulanda", "Saman√°", "Victoria", "Belalc√°zar", "Risaralda", "San Jos√©", "Viterbo", "Norcasia"],
            "Caquet√°": ["Florencia", "San Vicente del Cagu√°n", "Puerto Rico", "El Doncello", "El Paujil", "Cartagena del Chair√°", "Monta√±ita", "Bel√©n de los Andaqu√≠es", "Albania", "Curillo", "Mil√°n", "Morelia", "San Jos√© del Fragua", "Solano", "Solita", "Valpara√≠so"],
            "Casanare": ["Yopal", "Aguazul", "Villanueva", "Tauramena", "Paz de Ariporo", "Pore", "Trinidad", "San Luis de Palenque", "Orocu√©", "Nunch√≠a", "Hato Corozal", "T√°mara", "Monterrey", "Sabanalarga", "Recetor", "Ch√°meza", "La Salina", "S√°cama", "Man√≠"],
            "Cauca": ["Popay√°n", "Santander de Quilichao", "Puerto Tejada", "Pat√≠a", "Piendam√≥", "Cajib√≠o", "Silvia", "Timb√≠o", "Bol√≠var", "Miranda", "Corinto", "Caloto", "Guachen√©", "Villarrica", "Padilla", "Buenos Aires", "Su√°rez", "Morales", "El Tambo", "Argelia", "Balboa", "Mercaderes", "La Sierra", "La Vega", "Almaguer", "San Sebasti√°n", "Rosas", "Sotar√°", "Purac√©", "Totor√≥", "Inz√°", "P√°ez", "Jambal√≥", "Torib√≠o", "Caldono", "Timbiqu√≠", "Guapi", "L√≥pez de Micay"],
            "Cesar": ["Valledupar", "Aguachica", "Agust√≠n Codazzi", "Bosconia", "Chimichagua", "Chiriguan√°", "Curuman√≠", "El Copey", "El Paso", "Gamarra", "Gonz√°lez", "La Gloria", "La Jagua de Ibirico", "La Paz", "Manaure Balc√≥n del Cesar", "Pailitas", "Pelaya", "Pueblo Bello", "R√≠o de Oro", "San Alberto", "San Diego", "San Mart√≠n", "Tamalameque"],
            "Choc√≥": ["Quibd√≥", "Istmina", "Tad√≥", "Condoto", "Bah√≠a Solano", "Nuqu√≠", "Acand√≠", "Ungu√≠a", "Riosucio", "Carmen del Dari√©n", "Bojay√°", "Medio Atrato", "Atrato", "Llor√≥", "Bagad√≥", "Certegu√≠", "N√≥vita", "San Jos√© del Palmar", "El Carmen de Atrato", "Jurad√≥", "Alto Baud√≥", "Bajo Baud√≥", "Medio Baud√≥"],
            "C√≥rdoba": ["Monter√≠a", "Ceret√©", "Sahag√∫n", "Lorica", "Montel√≠bano", "Planeta Rica", "Tierralta", "Ci√©naga de Oro", "San Andr√©s de Sotavento", "San Pelayo", "San Carlos", "Chin√∫", "Puerto Escondido", "Mo√±itos", "Los C√≥rdobas", "Canalete", "Valencia", "Pueblo Nuevo", "La Apartada", "Buenavista", "Ayapel", "San Bernardo del Viento", "Pur√≠sima", "Momil", "Chim√°", "Cotorra", "San Antero", "Tuch√≠n"],
            "Cundinamarca": ["Soacha", "Facatativ√°", "Zipaquir√°", "Ch√≠a", "Fusagasug√°", "Girardot", "Madrid", "Mosquera", "Funza", "Cajic√°", "Sibat√©", "Tocancip√°", "Sop√≥", "La Calera", "Cota", "Tabio", "Tenjo", "Subachoque", "El Rosal", "Bojac√°", "Cachipay", "Anolaima", "La Mesa", "Anapoima", "Apulo", "Viot√°", "Tocaima", "Agua de Dios", "Ricaurte", "Nilo", "Villeta", "√ötica", "Nimaima", "Nocaima", "La Palma", "Pacho", "Zipac√≥n", "Guaduas", "Puerto Salgar", "Ubat√©", "Nemoc√≥n", "Cogua", "Gachancip√°", "Suesca", "Sesquil√©", "Chocont√°", "Villapinz√≥n", "Guatavita", "Guasca", "Jun√≠n", "Gachal√°", "Medina", "Paratebueno", "Arbel√°ez", "Pasca", "Silvania", "Granada", "La Vega", "F√≥meque", "Choach√≠", "Ubaque", "C√°queza", "Chipaque", "Une"],
            "Guain√≠a": ["In√≠rida", "Barranco Minas", "Mapiripana", "San Felipe", "Puerto Colombia", "La Guadalupe", "Cacahual", "Pana Pana", "Morichal"],
            "Guaviare": ["San Jos√© del Guaviare", "Calamar", "El Retorno", "Miraflores"],
            "Huila": ["Neiva", "Pitalito", "Garz√≥n", "La Plata", "Campoalegre", "Palermo", "Algeciras", "Colombia", "Rivera", "Aipe", "Villavieja", "Tello", "Baraya", "Yaguar√°", "Hobo", "Gigante", "Agrado", "Altamira", "Guadalupe", "Suaza", "Acevedo", "Timan√°", "El√≠as", "Oporapa", "Saladoblanco", "Isnos", "San Agust√≠n", "Palestina", "Pital", "Tesalia", "Paicol", "N√°taga", "√çquira", "Teruel", "Tarqui"],
            "La Guajira": ["Riohacha", "Maicao", "Uribia", "Manaure", "San Juan del Cesar", "Fonseca", "Barrancas", "Villanueva", "El Molino", "Urumita", "La Jagua del Pilar", "Hatonuevo", "Albania", "Distracci√≥n", "Dibulla"],
            "Magdalena": ["Santa Marta", "Ci√©naga", "Fundaci√≥n", "El Banco", "Plato", "Aracataca", "Pivijay", "Zona Bananera", "El Ret√©n", "Algarrobo", "Ariguan√≠", "Cerro de San Antonio", "Chibolo", "Concordia", "El Pi√±√≥n", "Guamal", "Nueva Granada", "Pedraza", "Piji√±o del Carmen", "Puebloviejo", "Remolino", "Sabanas de San √Ångel", "Salamina", "San Sebasti√°n de Buenavista", "San Zen√≥n", "Santa Ana", "Santa B√°rbara de Pinto", "Sitionuevo", "Tenerife", "Zapay√°n"],
            "Meta": ["Villavicencio", "Acac√≠as", "Granada", "Puerto L√≥pez", "San Mart√≠n", "Cumaral", "Restrepo", "Puerto Gait√°n", "Guamal", "Castilla la Nueva", "San Carlos de Guaroa", "Barranca de Up√≠a", "Cabuyaro", "Puerto Lleras", "Puerto Rico", "Vista Hermosa", "San Juan de Arama", "Mesetas", "Lejan√≠as", "El Castillo", "El Dorado", "Uribe", "La Macarena", "Mapirip√°n", "Puerto Concordia", "El Calvario", "San Juanito", "Fuente de Oro"],
            "Nari√±o": ["Pasto", "Tumaco", "Ipiales", "T√∫querres", "La Uni√≥n", "Samaniego", "Sandon√°", "Barbacoas", "El Charco", "Olaya Herrera", "La Tola", "Mag√º√≠ Pay√°n", "Roberto Pay√°n", "Francisco Pizarro", "Mosquera", "Santa B√°rbara", "Cumbitara", "Policarpa", "Los Andes", "El Rosario", "Leiva", "El Tambo", "Taminango", "San Lorenzo", "Arboleda", "San Pedro de Cartago", "Alb√°n", "Buesaco", "Chachag√º√≠", "El Tabl√≥n de G√≥mez", "La Florida", "Nari√±o", "Tangua", "Yacuanquer", "Consac√°", "Ancuya", "Linares", "La Llanada", "Sotomayor", "Santacruz", "Sapuyes", "Ospina", "Iles", "Gualmat√°n", "Contadero", "C√≥rdoba", "Puerres", "Funes", "Potos√≠", "Cuaspud Carlosama", "Aldana", "Guachucal", "Cumbal", "Mallama", "Ricaurte"],
            "Norte de Santander": ["C√∫cuta", "Oca√±a", "Pamplona", "Villa del Rosario", "Los Patios", "El Zulia", "Tib√∫", "Sardinata", "Chin√°cota", "√Åbrego", "Convenci√≥n", "El Tarra", "Hacar√≠", "La Playa", "San Calixto", "Teorama", "C√°chira", "La Esperanza", "Santiago", "Durania", "Arboledas", "Cucutilla", "Gramalote", "Lourdes", "Salazar", "Villa Caro", "Bucarasica", "Bochalema", "Herr√°n", "Ragonvalia", "Labateca", "Toledo", "Chitag√°", "C√°cota", "Mutiscua", "Silos", "Puerto Santander"],
            "Putumayo": ["Mocoa", "Puerto As√≠s", "Orito", "Valle del Guamuez", "San Miguel", "Villagarz√≥n", "Puerto Caicedo", "Puerto Guzm√°n", "Legu√≠zamo", "Sibundoy", "Col√≥n", "Santiago", "San Francisco"],
            "Quind√≠o": ["Armenia", "Calarc√°", "Montenegro", "Quimbaya", "La Tebaida", "Circasia", "Filandia", "Salento", "G√©nova", "Pijao", "Buenavista", "C√≥rdoba"],
            "Risaralda": ["Pereira", "Dosquebradas", "Santa Rosa de Cabal", "La Virginia", "Bel√©n de Umbr√≠a", "Quinch√≠a", "Gu√°tica", "Marsella", "Santuario", "Ap√≠a", "La Celia", "Balboa", "Pueblo Rico", "Mistrat√≥"],
            "San Andr√©s y Providencia": ["San Andr√©s", "Providencia"],
            "Santander": ["Bucaramanga", "Floridablanca", "Gir√≥n", "Piedecuesta", "Barrancabermeja", "San Gil", "Socorro", "V√©lez", "Barbosa", "Puerto Wilches", "Sabana de Torres", "Lebrija", "Rionegro", "Cimitarra", "M√°laga", "Charal√°", "Oiba", "Guadalupe", "Suaita", "Contrataci√≥n", "El Play√≥n", "Zapatoca", "Los Santos", "Villanueva", "Curit√≠", "Aratoca", "Mogotes", "San Joaqu√≠n", "Onzaga", "Encino", "Capitanejo", "Macaravita", "San Miguel", "Carcas√≠", "Cerrito", "Concepci√≥n", "Guaca", "San Andr√©s"],
            "Sucre": ["Sincelejo", "Corozal", "San Marcos", "Sampu√©s", "Tol√∫", "San Onofre", "Cove√±as", "Sinc√©", "Galeras", "Los Palmitos", "Morroa", "Buenavista", "San Pedro", "Majagual", "Sucre", "Guaranda", "Chal√°n", "Coloso", "Ovejas", "San Antonio de Palmito", "Tol√∫ Viejo", "San Benito Abad", "Caimito", "La Uni√≥n", "San Juan de Betulia", "El Roble"],
            "Tolima": ["Ibagu√©", "Espinal", "Melgar", "Chaparral", "L√≠bano", "Honda", "Mariquita", "Fresno", "Guamo", "Purificaci√≥n", "Natagaima", "Coyaima", "Ortega", "Planadas", "Rioblanco", "Ataco", "Salda√±a", "Prado", "Dolores", "Alpujarra", "Villarrica", "Cunday", "Icononzo", "Falan", "Palocabildo", "Casabianca", "Villahermosa", "L√©rida", "Ambalema", "Venadillo", "Piedras", "Alvarado", "Anzo√°tegui", "Santa Isabel", "Murillo", "Herveo", "Cajamarca", "Rovira", "Roncesvalles", "San Antonio", "Valle de San Juan", "San Luis", "Carmen de Apical√°", "Su√°rez", "Flandes", "Coello"],
            "Valle del Cauca": ["Cali", "Buenaventura", "Palmira", "Tulu√°", "Buga", "Cartago", "Jamund√≠", "Yumbo", "Florida", "Candelaria", "Pradera", "El Cerrito", "Zarzal", "Roldanillo", "Sevilla", "Caicedonia", "Dagua", "La Uni√≥n", "Ginebra", "Guacar√≠", "San Pedro", "Andaluc√≠a", "Bugalagrande", "Trujillo", "Riofrio", "Obando", "La Victoria", "Toro", "Ansermanuevo", "El √Åguila", "El Cairo", "Argelia", "Versalles", "El Dovio", "Bol√≠var", "Alcal√°", "Ulloa", "Restrepo", "Calima", "Vijes", "Yotoco"],
            "Vaup√©s": ["Mit√∫", "Carur√∫", "Taraira", "Papunaua", "Yavarat√©", "Pacoa"],
            "Vichada": ["Puerto Carre√±o", "La Primavera", "Santa Rosal√≠a", "Cumaribo"]
        };

        // === INICIALIZAR P√ÅGINA ===
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar bot√≥n volver
            document.getElementById('backBtn').href = backUrl;

            // Cargar departamentos
            const deptSelect = document.getElementById('departamento');
            const citySelect = document.getElementById('ciudad');
            
            Object.keys(colombiaData).sort().forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                deptSelect.appendChild(option);
            });

            // Evento para cargar municipios
            deptSelect.addEventListener('change', function() {
                const selectedDept = this.value;
                citySelect.innerHTML = '<option value="">Selecciona municipio</option>';
                
                if (selectedDept && colombiaData[selectedDept]) {
                    citySelect.disabled = false;
                    colombiaData[selectedDept].sort().forEach(city => {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    });
                } else {
                    citySelect.disabled = true;
                    citySelect.innerHTML = '<option value="">Primero selecciona departamento</option>';
                }
            });

            // Mostrar informaci√≥n del producto
            document.getElementById('productName').textContent = productName;
            document.getElementById('productDesc').textContent = productDesc;
            document.getElementById('summaryProduct').textContent = productName;

            // Mostrar imagen si existe
            if (productImage) {
                const imgEl = document.getElementById('productImg');
                imgEl.src = productImage;
                imgEl.style.display = 'block';
                document.getElementById('productPlaceholder').style.display = 'none';
            }

            // Mostrar precio
            if (productPrice > 0) {
                if (productPriceOriginal > 0) {
                    document.getElementById('productPrice').innerHTML = '<span style="text-decoration: line-through; color: #999; font-size: 0.8em;">' + formatPrice(productPriceOriginal) + '</span> ' + formatPrice(productPrice) + ' <span>COP</span>';
                } else {
                    document.getElementById('productPrice').innerHTML = formatPrice(productPrice) + ' <span>COP</span>';
                }
                document.getElementById('summaryUnitPrice').textContent = formatPrice(productPrice);
            } else {
                document.getElementById('productPrice').textContent = '¬°Cotiza Ahora!';
                document.getElementById('summaryUnitPrice').textContent = 'A cotizar';
            }

            updateTotals();
        });

        // === FORMATEAR PRECIO ===
        function formatPrice(price) {
            return '$' + price.toLocaleString('es-CO');
        }

        // === CAMBIAR CANTIDAD ===
        function changeQty(delta) {
            const input = document.getElementById('quantity');
            let value = parseInt(input.value) || 1;
            value = Math.max(1, Math.min(99, value + delta));
            input.value = value;
            updateTotals();
        }

        // === ACTUALIZAR TOTALES ===
        function updateTotals() {
            const qty = parseInt(document.getElementById('quantity').value) || 1;
            document.getElementById('summaryQty').textContent = qty;

            if (productPrice > 0) {
                const total = productPrice * qty;
                document.getElementById('summaryTotal').textContent = formatPrice(total);
            } else {
                document.getElementById('summaryTotal').textContent = 'A cotizar';
            }
        }

        // === VARIABLES GLOBALES ===
        let orderText = '';

        // === GENERAR TEXTO DEL PEDIDO ===
        function generateOrderText(data) {
            const ticketNumber = 'GS-' + new Date().getFullYear() + '-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const qty = parseInt(document.getElementById('quantity').value) || 1;
            const total = productPrice > 0 ? formatPrice(productPrice * qty) : 'A cotizar';
            const unitPrice = productPrice > 0 ? formatPrice(productPrice) : 'A cotizar';
            
            return `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üõí PEDIDO G&S TAPICER√çA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üìã N¬∞ de Pedido: ${ticketNumber}
üìÖ Fecha: ${new Date().toLocaleDateString('es-CO')}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üì¶ PRODUCTO
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Producto: ${productName}
‚Ä¢ Cantidad: ${qty}
‚Ä¢ Precio unitario: ${unitPrice}
‚Ä¢ TOTAL: ${total}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ DATOS DEL CLIENTE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Nombre: ${data.nombre}
‚Ä¢ Tel√©fono: ${data.telefono}
‚Ä¢ Email: ${data.correo}
‚Ä¢ C√©dula: ${data.cedula}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìç DATOS DE ENV√çO
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Departamento: ${data.departamento}
‚Ä¢ Ciudad: ${data.ciudad}
‚Ä¢ Direcci√≥n: ${data.direccion}
‚Ä¢ Barrio: ${data.barrio || 'No especificado'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìù NOTAS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
${data.notas || 'Sin notas adicionales'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ú® Gracias por comprar en G&S
   Tapicer√≠a y Instalaciones
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;
        }

        // === MOSTRAR/OCULTAR MODAL ===
        function showModal() {
            document.getElementById('orderModal').classList.add('active');
        }

        function hideModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        // === COPIAR AL PORTAPAPELES ===
        function copyToClipboard() {
            navigator.clipboard.writeText(orderText).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.innerHTML = '‚úÖ ¬°Copiado!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = 'üìã Copiar Pedido';
                    btn.classList.remove('copied');
                }, 3000);
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = orderText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const btn = document.getElementById('copyBtn');
                btn.innerHTML = '‚úÖ ¬°Copiado!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = 'üìã Copiar Pedido';
                    btn.classList.remove('copied');
                }, 3000);
            });
        }

        // === MANEJAR ENV√çO DEL FORMULARIO ===
        document.getElementById('checkoutForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const data = {
                nombre: document.getElementById('nombre').value,
                telefono: document.getElementById('telefono').value,
                correo: document.getElementById('correo').value,
                cedula: document.getElementById('cedula').value,
                departamento: document.getElementById('departamento').value,
                ciudad: document.getElementById('ciudad').value,
                direccion: document.getElementById('direccion').value,
                barrio: document.getElementById('barrio').value,
                notas: document.getElementById('notas').value
            };

            // Mostrar loading
            document.getElementById('loadingOverlay').classList.add('active');

            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.remove('active');
                orderText = generateOrderText(data);
                document.getElementById('orderInfoText').textContent = orderText;
                showModal();
            }, 600);
        });

        // === EVENT LISTENERS ===
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('closeModalBtn').addEventListener('click', hideModal);

        document.getElementById('orderModal').addEventListener('click', function(e) {
            if (e.target === this) hideModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') hideModal();
        });
    </script>
</body>
</html>
